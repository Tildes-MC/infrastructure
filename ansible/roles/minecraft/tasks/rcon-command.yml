---
# Execute a command on the running Minecraft server via RCON.
#
# Required variables:
#   minecraft_command: The command to send (e.g. "lp import init")

- name: "Execute minecraft command: {{ minecraft_command }}"
  ansible.builtin.command:
    cmd: "{{ minecraft_app_dir }}/scripts/rcon.py '{{ minecraft_command }}'"
  environment:
    RCON_PASSWORD: "{{ vault_rcon_password }}"
  become: true
  become_user: "{{ minecraft_user }}"
  register: minecraft_command_result
  changed_when: unchanged_output is not defined or unchanged_output not in minecraft_command_result.stdout
  failed_when: >-
    minecraft_command_result.rc != 0 or
    (expected_output is defined and
     expected_output not in minecraft_command_result.stdout and
     (unchanged_output is not defined or unchanged_output not in minecraft_command_result.stdout))
